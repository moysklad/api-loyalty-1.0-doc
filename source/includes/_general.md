# МойСклад LoyaltyAPI

API для интеграции МоегоСклада с системами лояльности.


## Сценарий работы
 
Предварительные условия:
- Пользователь на стороне МоегоСклада указывает __базовый адрес системы лояльности__ (в приведенных примерах обозначен как example.com/baseurl) и __ключ доступа__ .
- Пользователь на стороне системы лояльности указывает логин и пароль для доступа к МоемуСкладу.
- Система лояльности через [JSON API](https://dev.moysklad.ru/doc/api/remap/1.2) запрашивают всю необходимую информацию для настройки скидок (информация о покупателях, товарах, магазинах и т.д.).
- В настройках приложения лояльности на стороне МоегоСклада может быть выбран способ поиска покупателей: внутренний (в МоемСкладе) или внешний (в системе лояльности)

После всех настроек МойСклад может производить к системе лояльности следующие запросы:
- Создание покупателя
- Поиск покупателя
- Запрос баланса баллов покупателя
- Расчет скидок для продажи
- Создание продажи
- Создание возврата

Запросы осуществляются на определенный эндпоинт относительно базового адреса. Каждый из запросов содержит в своем составе ключ доступа.

## Обработка ошибок
Если возникла ошибка при обработке запроса, то она должна приходить с HTTP кодом, отличным от 200, 201 и 204

### Структура ошибок
Ошибки представляют собой массив **errors**, содержащий объекты **error**, каждый из которых описывает отдельную ошибку.

### Структура объекта error
+ **error** `string` - Заголовок ошибки `Необходимое`
+ **parameter** `string` - Параметр, на котором произошла ошибка
+ **code** `integer` - Код ошибки `Необходимое`
+ **error_message** `string` - Сообщение, прилагаемое к ошибке. `Необходимое`

> **Response**  
> 412 (application/json)

```json
{
  "errors": [
    {
      "error": "Не указан обязательный параметр",
      "parameter": "phone",
      "code": 999,
      "error_message": "Требуется указать номер телефона"
    }
  ]
}
```
